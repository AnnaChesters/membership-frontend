@(event: model.Eventbrite.RichEvent, pageInfo: model.PageInfo)

@import play.twirl.api.Html

@import views.support.Dates._
@import views.support.Social.eventDetail
@import com.github.nscala_time.time.Imports._
@import org.joda.time.Instant
@import model.Eventbrite._
@import com.gu.membership.salesforce.Tier
@import configuration.Config

@ticketCta = {
    @if(event.isSoldOut) {
        <button class="action action--disabled js-ticket-cta" disabled="disabled">Sold Out</button>
    } else {
        <a class="action action--event-buy js-ticket-cta" href="/event/@event.id/buy">Buy tickets</a>
    }
    <div class="terms-info">By proceeding, you agree to the<br /> Guardian Live events
        <a href="@Config.guardianLiveEventsTermsUrl" target="_blank">Terms and Conditions</a>
    </div>
}

@becomeMemberCta(ticket: EBTicketClass) = @{
    val ticketSaleDates = model.TicketSaleDates.datesFor(event, ticket)
    val friendCanBuyTicket = ticketSaleDates.tierCanBuyTicket(Tier.Friend)

    if(!friendCanBuyTicket) {
        Html("<div><a class='action js-member-cta' href='/join'>Become a member</a></div>")
    }
}

@main("Event Detail | " + event.name.text, pageInfo=pageInfo, containerPadding = false, isBrochure = true, htmlClass = "js-event") {
    <div class="event-header">
        <div class="event-header__container">
            <div class="event-masthead u-cf">
                <div class="event-masthead__title section-header page-header case--lower">Events</div>
                <h1 class="event-masthead__name">@event.name.text</h1>
            </div>
        </div>
    </div>

    <div class="event-header event-header--shade">
        <div class="event-header__container event-header__container--details">
            <div class="event-details">
                <div class="event-details__time">@prettyDateWithTimeAndDayName(event.start)</div>
                <div class="event-details__location">
                    <span class="event-details__location__venue-name">@event.venue.name</span>
                    @if(event.eventAddressLine.nonEmpty) {
                        <span class="event-details__location__address">
                            , @event.eventAddressLine
                        </span>
                    }
                </div>
            </div>
            @if(event.isNoTicketEvent == false) {
                @for(ticket <- event.generalReleaseTicket) {
                    <div class="event-ticket u-cf">
                        <div class="event-ticket__details">

                            @if(ticket.free) {
                                <div class="event-ticket__price">
                                    <span class="event-ticket__price-amount js-event-price">Free</span>
                                </div>
                            } else {
                                @for(pricing <- ticket.cost) {
                                    <div class="event-ticket__price">
                                        <span class="event-ticket__price-amount js-event-price">@pricing.formattedPrice</span>
                                    </div>
                                    <div class="event-ticket__trail">
                                        <span class="event-ticket__trail-tag js-event-price-tag">Partners/Patrons </span>
                                        <span class="event-ticket__trail-upsell js-event-price-discount">@pricing.discountPrice</span>
                                        <span class="event-ticket__trail-saving js-event-price-saving"> (save @pricing.savingPrice)</span>
                                    </div>
                                }
                            }
                        </div>
                        @ticketCta
                    </div>
                }
            }
            <div class="guardian-live-logo">
                <i class="icon-sprite icon-sprite-guardian-live icon-sprite--resize-live-logo"></i>
            </div>
        </div>

    </div>


    <div class="event-content">

        <div class="event-content__image">
            <div class="delayed-image-load" data-src="@event.imgUrl" data-alt="Please upload an event image" data-class="responsive-img"></div>
        </div>

        <div class="event-content__container u-cf">

            <div class="event-content__body">
                <div class="event__description">@Html(event.description.getOrElse(EBRichText("foobar", "foobarhtml")).cleanHtml)</div>
                <div class="event__social">
                    <div class="event__social-header hidden-mobile">Share this</div>
                    @fragments.social(eventDetail(event))
                </div>
            </div>

            <div class="event-content__info">
                <div class="event-content__name">@event.name.text</div>
                <div class="event-content__time event-content--line-divider u-cf">
                    <div class="event-content__first">
                        <i class="icon-sprite icon-sprite-large-early_booking icon-sprite--small"></i>
                    </div>
                    <div class="event-content__second">@prettyDateWithTimeAndDayName(event.start)</div>
                </div>
                <div class="event-content__location event-content--line-divider u-cf">
                    <div class="event-content__first">
                        <i class="icon-sprite icon-sprite-location icon-sprite--small"></i>
                    </div>
                    <div class="event-content__second">
                        <span class="event-content__venue-name">@event.venue.name</span>
                        @if(event.eventAddressLine.nonEmpty) {
                            <span class="event-content__address">@event.eventAddressLine</span>
                        }
                    </div>
                </div>

                @if(event.isNoTicketEvent == false) {

                    @for(ticket <- event.generalReleaseTicket) {

                        <div class="event-content__tickets event-content--line-divider u-cf">
                            @fragments.event.ticketSales(event, ticket)

                            @if(ticket.free) {
                                <div class="event-content__price event-content--line-divider">
                                    <span class="event-content__price-amount js-event-price">Free</span>
                                </div>
                            } else {
                                @for(pricing <- ticket.cost) {
                                    <div class="event-content__price event-content--line-divider">
                                        <span class="event-content__price-amount js-event-price">@pricing.formattedPrice</span>
                                    </div>
                                    <div class="event-content__trail">
                                        <span class="event-content__trail-tag js-event-price-tag">Partners/Patrons </span>
                                        <span class="event-content__trail-upsell js-event-price-discount">@pricing.discountPrice</span>
                                        <span class="event-content__trail-saving js-event-price-saving"> (save @pricing.savingPrice)</span>
                                    </div>
                                }
                            }
                            @ticketCta
                            @becomeMemberCta(ticket)
                        </div>
                    }
                }
            </div>
        </div>
    </div>

}
