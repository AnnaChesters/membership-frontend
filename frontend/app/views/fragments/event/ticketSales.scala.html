@(event: model.RichEvent.RichEvent, ticketing: model.Eventbrite.InternalTicketing)

@import com.gu.membership.salesforce.Tier
@import model.RichEvent._
@import org.joda.time.Instant
@import views.support.Dates._

@ticketDateForTier(tier: Tier, salesDate: Instant, needToDisplayTimes: Boolean) = @{
    Html(s"<time class='js-ticket-sale-start-${tier.slug}' datetime='$salesDate'>${salesDate.pretty(needToDisplayTimes)}</time>")
}

@ticketEndSaleDate(endSalesDate: Instant, needToDisplayTimes: Boolean) = @{
    Html(s"<time class='qa-event-detail-sales-end' datetime='$endSalesDate'>${endSalesDate.pretty(needToDisplayTimes || endSalesDate.isContemporary())}</time>")
}

<div class="ticket-sales">
    <span class="ticket-sales__header">@if(ticketing.salesDates.anyoneCanBuyTicket) {Tickets on sale now} else {Ticket release dates}</span>
    @if(ticketing.salesDates.anyoneCanBuyTicket) {
        <button class="ticket-sales__toggle u-button-reset js-toggle"
                data-toggle-label="Hide"
                data-toggle="js-event-ticket-dates-@event.id"
                data-metric-trigger="click"
                data-metric-category="events"
                data-metric-action="toggle-release-dates"
                data-toggle-icon="triangle-up">
            @fragments.inlineIcon("triangle-down", Seq("u-align-right"))
            Release dates
        </button>
    }
    <ul class="ticket-sales__list u-unstyled"
        id="js-event-ticket-dates-@event.id"
        @if(ticketing.salesDates.anyoneCanBuyTicket) { data-toggle-hidden}
    >
        <li class="ticket-sales__item">
            <span class="ticket-sales__item__label">Priority booking</span>
            <span class="ticket-sales__item__date">
            @ticketDateForTier(Tier.Patron, ticketing.salesDates .datesByTier(Tier.Patron), ticketing.salesDates.needToDistinguishTimes)
            </span>
        </li>
        <li class="ticket-sales__item">
            <span class="ticket-sales__item__label">General release</span>
            <span class="ticket-sales__item__date">
            @ticketDateForTier(Tier.Friend, ticketing.salesDates .datesByTier(Tier.Friend), ticketing.salesDates.needToDistinguishTimes)
            </span>
        </li>
    </ul>
    <ul class="ticket-sales__list u-unstyled">
        <li class="ticket-sales__item">
            <span class="ticket-sales__item__label">Sale ends</span>
            <span class="ticket-sales__item__date">
                @ticketEndSaleDate(ticketing.salesEnd, ticketing.salesDates.needToDistinguishTimes)
            </span>
        </li>
    </ul>
</div>
