@(staffEmail: model.StaffEmails, displayName: Option[String], avatarUrl: Option[String], error: Option[String])(implicit token: play.filters.csrf.CSRF.Token)

@import com.gu.membership.salesforce.Tier
@import configuration.Config
@import helper._
@import play.twirl.api.Html
@import model.Faq

@signPostItem(btnText: String, btnSrc: String, title: String = "")(description: Html) = {
    <li class="signpost-item">
        @if(title){
            <h4 class="signpost-item__title">@title</h4>
        }
        <p class="signpost-item__description">@description</p>
        <div class="signpost__cta">
            <a class="action action--no-bottom-margin" href="@btnSrc">@btnText</a>
        </div>
    </li>
}

@main("Staff Membership", containerPadding=false) {

    <main class="page-container__inner" role="main">

        @fragments.notifications.flashMessage(error)

        @fragments.page.pageHeader("Guardian Staff Membership",
            Some("All permanent Guardian staff can sign up to the Partner tier of Guardian membership for free (equivalent to Â£15/month)"))

        <section class="page-section page-section--bordered">
            <div class="page-section__lead-in">
                <h2 class="page-section__headline">Join</h2>
            </div>
            <div class="page-section__content">
                @staffEmail.identityEmail.fold {
                    <p>Before joining you must have a  Guardian Identity account set up with your work email address.</p>

                    <ul class="signpost u-unstyled">
                        @signPostItem("Create account", Config.idWebAppRegisterUrl(routes.Joiner.staff.url)){
                            Create a Guardian Identity account with your work email address
                        }
                        @signPostItem("Sign in", Config.idWebAppSigninUrl(routes.Joiner.staff.url)){
                            Sign in to Guardian Identity with your work email address
                        }
                    </ul>

                } { identityEmail =>

                    <div class="user-welcome u-cf copy">
                        @for(srcUrl <- avatarUrl){
                            <img class="user-welcome__image user-img" src="@srcUrl" alt="User Image"/>
                        }
                        <div class="user-welcome__content">
                            @for(name <- displayName){
                                <h3 class="user-welcome__title">Hello <strong>@displayName</strong>. Not you? <a href="@Config.idWebAppUrl/signout">Sign out</a></h3>
                            }
                            <div class="user-welcome__info">
                                <p>Glad to see you've decided to join Guardian Staff Membership.</p>
                            </div>
                        </div>
                    </div>

                    @if(staffEmail.emailsMatch) {
                        <p>Join Guardian Staff Membership as <strong>@identityEmail</strong></p>
                        <a class="action action--no-bottom-margin" href="@routes.Joiner.enterStaffDetails">Join</a>
                        <a class="action action--secondary-button action--no-bottom-margin" href="@Config.idWebAppUrl/signout">Sign out</a>
                    } else {
                        <p>Before joining you must have a Guardian Identity account set up using your work email address <strong>(@staffEmail.googleEmail)</strong></p>

                        <p>You're signed in as <strong>@identityEmail</strong>, unfortunately this isn't a valid email address for Guardian Staff Membership.</p>
                        <p>You have two options to join:</p>
                        <ul class="signpost u-unstyled">
                            <li class="signpost-item">
                                <h4 class="signpost-item__title">Option 1</h4>
                                <p class="signpost-item__description">
                                    Allow Guardian membership to change your Guardian Identity email address from <strong>@identityEmail</strong> to <strong>@staffEmail.googleEmail</strong
                                </p>
                                <div class="signpost__cta">
                                    <form action="@routes.Joiner.updateEmailStaff" method="POST">
                                        @CSRF.formField
                                        <button class="action action--no-bottom-margin" type="submit">Change email for me</button>
                                    </form>
                                </div>
                            </li>
                            @signPostItem("Register Now", Config.idWebAppRegisterUrl(routes.Joiner.staff.url), "Option 2"){
                                Register for a new Guardian Identity account using your work email address <strong>@staffEmail.googleEmail</strong>
                            }
                        </ul>
                    }
                }
            </div>
        </section>

        <section class="page-section page-section--bordered">
            <div class="page-section__lead-in">
                <h2 class="page-section__headline">Benefits</h2>
            </div>
            <div class="page-section__content">
                @fragments.benefits.detail(Tier.Partner)
            </div>
        </section>

        <section class="page-section page-section--bordered">
            <div class="page-section__lead-in">
                <h2 class="page-section__headline">Questions</h2>
            </div>
            <div class="page-section__content">
                @fragments.faq.answers(Faq.staff)
            </div>
        </section>
    </main>
}
