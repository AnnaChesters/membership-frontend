@(
    groupedEvents: scala.collection.SortedMap[org.joda.time.LocalDate, Seq[model.RichEvent.RichEvent]],
    pageInfo: model.PageInfo,
    cities: Seq[model.CityLink],
    location: Option[String]
)

@dateGroup(title: String, events: Seq[model.RichEvent.RichEvent], classes: Seq[String] = Nil) = {
    <section class="date-listing @classes.mkString(" ")">
        <div class="date-listing__lead-in">
            <h3 class="date-listing__title">@title</h3>
        </div>
        <div class="date-listing__content">
            <ul class="grid grid--3up grid--bordered">
            @for(event <- events) {
                <li class="grid__item">
                    @fragments.event.item(event, showPrice=false)
                </li>
            }
            </ul>
        </div>
    </section>
}

@main("Calendar | What's On", pageInfo) {
    <main role="main" class="page-content l-constrained">

        @fragments.page.pageHeader("Calendar", None)

        <form method="get">
            <select name="location">
                <option value="all">All locations</option>
                @for(c <- cities) {
                    <option value="@c.slug"@if(location.getOrElse("")==c.slug){ selected="selected"}>@c.name (@c.count)</option>
                }
            </select>
            <select name="period">
                <option value="7-days">Next 7 days</option>
                <option value="14-days">Next 14 days</option>
                <option value="30-days">Next 30 days</option>
            </select>
            <input type="submit" value="Apply filter" />
        </form>

        <div class="filter-bar">
            <a class="action action--no-icon" href="@routes.WhatsOn.calendarList" aria-title="View events as a list" title="View events as a list">
                @fragments.actionIcon("list-view", leftIcon=true)
                List view
            </a>
        </div>

        @for(group <- groupedEvents.headOption) {
            @dateGroup(group._1.toString("MMMMM Y"), group._2, List("date-listing--lead"))
        }
        @for(group <- groupedEvents.drop(1)) {
            @dateGroup(group._1.toString("MMMMM Y"), group._2)
        }

    </main>
}
